\documentclass[slidestop]{beamer}
\usepackage[utf8]{inputenc}
\usepackage{pgf}
\usepackage{algorithmic}
\usepackage{wrapfig}
\usepackage{array}
\usepackage{subfigure}
\usepackage{xmpmulti}
\usepackage{listings}

\usetheme{JuanLesPins}
\usecolortheme{beaver}
\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{footline}[frame number]
\title[B.A.T.M.A.N. V: what's coming next?]{B.A.T.M.A.N. V: what's coming next?}
\author{Marek Lindner \& Antonio Quartulli}
\date{May 14th, 2014\\WirelessBattleMeshv7 - Leipzig}
\institute[]{B.A.T.M.A.N.-Advanced\\www.open-mesh.org}

\newcommand{\cfbox}[2]{
	\colorlet{currentcolor}{.}
	{\color{#1}
	\fbox{\color{currentcolor}#2}}
}


\begin{document}

\begin{frame}
	\titlepage
\end{frame}

\section{Introduction}
\begin{frame}[c]
	\frametitle{A few words about batman-adv\dots}

	The B.A.T.M.A.N. protocol was initiated in Berlin, 2006. The first edition was developed as a daemon, and moved to kernel space in 2007 to improve performance.

	Characteristics:
	\begin{itemize}
		\item L2 routing (MAC address layer)
		\item runs on any Ethernet capable device (e.g. 802.3, 802.11, and 802.15.1)
		\item encapsulates incoming ether frames and handles all forwarding/delivery
		\item agnostic to IP or any L3 protocol
		\item supports non-mesh clients with gateway selection, roaming \& more
		\item part of the Linux kernel, thus shipped by default in most Linux distributions (modprobe batman-adv)
	\end{itemize}
\end{frame}

\begin{frame}[c]
	\frametitle{What we are NOT going to talk about today}
	\begin{itemize}
		\item backward compatibility (TVLV, compat number, etc)
		\item VLAN-ization of non-mesh client handling
		\item fragmentation v2.0 (we fragment everything!)
		\item extended AP isolation
		\item multicast improvements
		\item inter-connecting batman clouds
		\item layer2 anycast support
		\item DHT generalization (IPv6 address caching, ..)
		\item ...
	\end{itemize}
\end{frame}

\begin{frame}[c]
	\frametitle{Today's topics}
	\begin{itemize}
		\item B.A.T.M.A.N. V introduction
		\item network-wide multi-interface optimizations
		\item protocol overview (ELP/OGMv2)
		\item throughput based metric
		\item current status / practical tips
		\item next steps
	\end{itemize}
\end{frame}

\section{Multi-if routing}
\begin{frame}[c]
	\frametitle{Network-wide multi-interface optimization}

	brief recap:

	\begin{itemize}
		\item batman-adv supports link-local multi-iface optimizations since early 2010
		\item results were good but we can do better ..
	\end{itemize}

	\addvspace{1.0cm}

	B.A.T.M.A.N. V roadmap (extract):

	\begin{itemize}
		\item differentiation between half duplex / full duplex
		\item take advantage of the many interfaces devices are powered with today
		\item maximizing traffic throughput applying rules to the traffic flow
	\end{itemize}
\end{frame}

\begin{frame}[c]
	\frametitle{Network-wide multi-interface optimization (2)}

	in a nutshell:
	\begin{figure}
		\centering
		\includegraphics[scale=0.4]{images/multi-if1.pdf}
	\end{figure}
\end{frame}

\begin{frame}[c]
	\frametitle{Network-wide multi-interface optimization (3)}

	\begin{figure}
		\centering
		\includegraphics[scale=0.4]{images/multi-if2.pdf}
	\end{figure}
\end{frame}

\begin{frame}[c,fragile]
	\frametitle{Network-wide multi-interface optimization (4)}

	The tables:

	\begin{itemize}
		\item each interface has its own routing table
		\item the default table is used for traffic originating from the host itself
	\end{itemize}

	batctl o / batctl o -i eth0
	\begin{lstlisting}[basicstyle=\tiny]
root@OpenWrt:/# batctl o
[B.A.T.M.A.N. adv master-b82b9b2, MainIF/MAC: eth0/fe:f0:00:00:02:01 (bat0 BATMAN_IV)]
  Originator      last-seen (#/255)           Nexthop [outgoingIF]:   Potential nexthops ...
  fe:f1:00:00:03:01    0.350s   (254) fe:f1:00:00:03:01 [      eth1]: fe:f1:00:00:03:01 (254)
  fe:f1:00:00:01:01    0.800s   (255) fe:f1:00:00:01:01 [      eth1]: fe:f1:00:00:01:01 (255)
  fe:f0:00:00:05:01    0.770s   (225) fe:f1:00:00:03:01 [      eth1]: fe:f0:00:00:03:01 (211) fe:f1:00:00:03:01 (225)
  fe:f0:00:00:03:01    0.670s   (255) fe:f0:00:00:03:01 [      eth0]: fe:f1:00:00:03:01 (255) fe:f0:00:00:03:01 (255)
  fe:f0:00:00:04:01    0.520s   (234) fe:f1:00:00:03:01 [      eth1]: fe:f1:00:00:03:01 (234) fe:f0:00:00:03:01 (222)
  fe:f0:00:00:01:01    0.920s   (255) fe:f1:00:00:01:01 [      eth1]: fe:f1:00:00:01:01 (255) fe:f0:00:00:01:01 (254)

root@OpenWrt:/# cat /sys/kernel/debug/batman_adv/eth0/originators
[B.A.T.M.A.N. adv master-b82b9b2, IF/MAC: eth0/fe:f0:00:00:02:01 (bat0 BATMAN_IV)]
  Originator      last-seen (#/255)           Nexthop [outgoingIF]:   Potential nexthops ...
  fe:f1:00:00:03:01    0.170s   (255) fe:f1:00:00:03:01 [      eth1]: fe:f1:00:00:03:01 (255)
  fe:f1:00:00:01:01    0.510s   (253) fe:f1:00:00:01:01 [      eth1]: fe:f1:00:00:01:01 (253)
  fe:f0:00:00:05:01    0.660s   (222) fe:f1:00:00:03:01 [      eth1]: fe:f0:00:00:03:01 (198) fe:f1:00:00:03:01 (222)
  fe:f0:00:00:03:01    0.560s   (252) fe:f1:00:00:03:01 [      eth1]: fe:f1:00:00:03:01 (252) fe:f0:00:00:03:01 (240)
  fe:f0:00:00:04:01    0.250s   (240) fe:f1:00:00:03:01 [      eth1]: fe:f1:00:00:03:01 (240) fe:f0:00:00:03:01 (211)
  fe:f0:00:00:01:01    0.850s   (255) fe:f1:00:00:01:01 [      eth1]: fe:f1:00:00:01:01 (255) fe:f0:00:00:01:01 (238)
  root@OpenWrt:/# cat /sys/kernel/debug/batman_adv/eth1/originators
  [B.A.T.M.A.N. adv master-b82b9b2, IF/MAC: eth1/fe:f1:00:00:02:01 (bat0 BATMAN_IV)]
    Originator      last-seen (#/255)           Nexthop [outgoingIF]:   Potential nexthops ...
    fe:f1:00:00:03:01    0.880s   (240) fe:f1:00:00:03:01 [      eth1]: fe:f1:00:00:03:01 (240)
    fe:f1:00:00:01:01    0.250s   (239) fe:f1:00:00:01:01 [      eth1]: fe:f1:00:00:01:01 (239)
    fe:f0:00:00:05:01    0.340s   (211) fe:f1:00:00:03:01 [      eth1]: fe:f0:00:00:03:01 (210) fe:f1:00:00:03:01 (211)
    fe:f0:00:00:03:01    0.260s   (253) fe:f0:00:00:03:01 [      eth0]: fe:f1:00:00:03:01 (240) fe:f0:00:00:03:01 (253)
    fe:f0:00:00:04:01    0.010s   (225) fe:f0:00:00:03:01 [      eth0]: fe:f1:00:00:03:01 (224) fe:f0:00:00:03:01 (225)
    fe:f0:00:00:01:01    0.510s   (255) fe:f0:00:00:01:01 [      eth0]: fe:f1:00:00:01:01 (240) fe:f0:00:00:01:01 (255)
	\end{lstlisting}

\end{frame}

\begin{frame}[c]
	\frametitle{Network-wide multi-interface optimization (5)}

	The benefits:
	\begin{figure}
		\centering
		\includegraphics[scale=0.175]{images/alternating-limited-view.pdf}
	\end{figure}
\end{frame}


\begin{frame}[c]
	\frametitle{Network-wide multi-interface optimization (6)}

	\begin{figure}
		\centering
		\includegraphics[scale=0.3]{images/net-wide-multiif.pdf}
	\end{figure}
\end{frame}

\section{Routing protocol}
\begin{frame}[c]
	\frametitle{B.A.T.M.A.N. IV - the present}
	\begin{itemize}
		\item packet loss based
		\item one packet (OGM) - two functions
			\begin{itemize}
				\item Neighbour discovery/Link quality
					measurement
				\item Routing information (and more..) diffusion
			\end{itemize}
		\item not easy to tune
	\end{itemize}
\end{frame}

\begin{frame}[c]
	\frametitle{B.A.T.M.A.N. V - the future}
	\begin{itemize}
		\item ''throughput`` based
		\item two packets - two functions
			\begin{itemize}
				\item ELP: Neighbour discovery/Link metric
					exchange
				\item OGM:Routing information (and more..) diffusion
			\end{itemize}
		\item ELP and OGM intervals can be tuned independently
	\end{itemize}
	\begin{figure}
		\centering
	\end{figure}
\end{frame}

\begin{frame}[c]
	\frametitle{How does the routing work?}
	picture and explanation on how the metric is propagated. (Simon had one
	in his notes two years ago)
\end{frame}

\begin{frame}[c]
	\frametitle{Reading throughput in kernel space (wifi)}
	explain the wifi case and the interaction with cfg/mac80211 (WIP)
	\begin{figure}
		\centering
		\includegraphics[scale=0.3]{images/wireless-stack.pdf}
	\end{figure}
\end{frame}

\begin{frame}[c]
	\frametitle{A new metric}
	\begin{center}
		Current metric: based on \textbf{packet loss}\\
		\pause
		New metric: based on \textbf{throughput}\\
	\end{center}
\end{frame}

\begin{frame}[c]
	\frametitle{Throughput in kernel space (Ethernet)}
	other cases:
	\begin{itemize}
		\item Ethernet connections (common scenario)\\
			read negotiated speed from the driver (not the best
			solution)
		\pause
		\item ADSL lines, VPN links, various tunnels\dots (less
			common)\\
			can't directly read it. Needs for an explicit
			measurement
	\end{itemize}
\end{frame}

\begin{frame}[c]
	\frametitle{Throughput in kernel space (VPN, ADSL, tunnels\dots)}
	Introduction of a throughput meter in the batman-adv module (started
	GSoC 2012)
\end{frame}

\begin{frame}[c]
	\frametitle{Bandwidth meter}
	\begin{itemize}
		\item re-implementation of TCP on batman-adv
		\item no need for IPs (use batman-adv identifiers)
		\item can be easily used with batctl (batman-adv userspace tool)
	\end{itemize}
\end{frame}

\begin{frame}[c]
	\frametitle{Current status}
	\begin{itemize}
		\item cfg/mac80211 patches have been sent to the linux-wireless
			mailing list. Still require some work, but close to
			integration
		\item a working B.A.T.M.A.N. V prototype is available in our git
			repository (interaction with cfg80211 must be adjusted)
		\item open problem: how to recover from a dead path faster?
	\end{itemize}
\end{frame}

\begin{frame}[c,fragile]
	\frametitle{How to use B.A.T.M.A.N. V on my node}
	The batman-adv kernel module is already able to host more than one
	routing algorithm
	\pause
	\begin{lstlisting}[basicstyle=\scriptsize]
	# cat /sys/kernel/debug/batman_adv/routing_algos
	BATMAN_IV
	BATMAN_V (only if compiled into the module)
	\end{lstlisting}
	\pause
	Benefits:
	\begin{itemize}
		\item the routing algorithm can be changed at runtime
	\end{itemize}
	\pause
	\begin{lstlisting}[basicstyle=\scriptsize]
	# echo BATMAN_V >/sys/module/batman_adv/parameters/routing_algo
	# batctl if add -m bat0 wlan0
	\end{lstlisting}
	\pause
	\begin{itemize}
		\item both algorithms can be used at the same time (on two
			different interfaces)
	\end{itemize}
	\begin{lstlisting}[basicstyle=\scriptsize]
	# echo BATMAN_IV >/sys/module/batman_adv/parameters/routing_algo
	# batctl if add -m bat1 wlan1
	\end{lstlisting}

\end{frame}

\begin{frame}[c]
	\frametitle{How to use B.A.T.M.A.N. V on my node (2)}
	\begin{figure}
		\centering
		\includegraphics[scale=0.28]{images/multi-protocols.pdf}
	\end{figure}
\end{frame}

\section{Conclusions}
\begin{frame}
	\frametitle{Contacts}
	Nice idea, needs a lot of testing.

	\textbf{Wiki:}\\
	http://www.open-mesh.org\\
	\textbf{IRC:}\\
	\#batman at irc.freenode.org\\
	\textbf{Mailing list} (check the wiki)
\end{frame}

\begin{frame}[c]
	\begin{center}
	\Large{\textbf{Thank you for your attention\\[1cm]
	Questions?}}
	\end{center}
\end{frame}

\end{document}
